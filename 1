<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>五題心理學測驗 + 雷達圖分析</title>
  <style>
    :root{ --bg:#f7f8fb; --card:#fff; --accent:#4f46e5; --muted:#6b7280 }
    body{font-family:system-ui,-apple-system,'Segoe UI',Roboto,'Noto Sans TC',"Helvetica Neue",Arial; background:var(--bg); margin:0; padding:20px; color:#111}
    .container{max-width:900px;margin:20px auto}
    .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(15,23,42,0.06)}
    h1{margin:0 0 8px;font-size:20px}
    p.lead{margin:0 0 16px;color:var(--muted)}
    .q{margin-bottom:12px}
    label{display:block;margin-bottom:8px;font-weight:600}
    .options{display:flex;gap:8px}
    .options button{flex:1;padding:10px;border-radius:8px;border:1px solid #e6e9ef;background:#fff;cursor:pointer}
    .options button.selected{background:var(--accent);color:#fff;border-color:transparent}
    .btn-row{display:flex;gap:8px;margin-top:12px}
    button.primary{background:var(--accent);color:#fff;padding:10px 14px;border-radius:8px;border:0;cursor:pointer}
    button.ghost{background:transparent;border:1px solid #e6e9ef;padding:10px;border-radius:8px;cursor:pointer}
    canvas{max-width:100%;}
    .result-meta{margin-top:12px;color:var(--muted)}
    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
    @media(min-width:700px){ .options button{padding:14px} }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>五題心理學測驗</h1>
      <p class="lead">每題請選出最符合你的選項（1-5 分）。測驗會把五題分成五個特質，並用雷達圖呈現結果。</p>

      <form id="quiz">
        <!-- New 5 questions with A-D options -->
        <div class="q" data-index="0">
          <label>1. 當你遇到一個新的挑戰/任務時，你的第一反應是？</label>
          <div class="options">
            <button type="button" data-score="A">A. 馬上跳進去、先試看看</button>
            <button type="button" data-score="B">B. 先觀察環境、研究方式</button>
            <button type="button" data-score="C">C. 有點猶豫、怕搞砸、先做部分準備</button>
            <button type="button" data-score="D">D. 想幫助他人、在背後支撐或配合</button>
          </div>
        </div>

        <div class="q" data-index="1">
          <label>2. 當朋友需要幫忙或情緒低落時，你通常會？</label>
          <div class="options">
            <button type="button" data-score="A">A. 鼓勵他們「快起來、一起去做點什麼」</button>
            <button type="button" data-score="B">B. 安靜陪伴、傾聽他們說出來</button>
            <button type="button" data-score="C">C. 有點退縮、不太確定怎麼幫比較好</button>
            <button type="button" data-score="D">D. 主動提供支持、做好後勤或照顧他們</button>
          </div>
        </div>

        <div class="q" data-index="2">
          <label>3. 當你思考人生或尋找方向時，你偏好？</label>
          <div class="options">
            <button type="button" data-score="A">A. 設定目標、立刻動手實踐</button>
            <button type="button" data-score="B">B. 深入思考、分析可能性</button>
            <button type="button" data-score="C">C. 小心翼翼、怕錯、慢慢走</button>
            <button type="button" data-score="D">D. 和他人分享、互相支持、一步一腳印</button>
          </div>
        </div>

        <div class="q" data-index="3">
          <label>4. 面對失敗或挫折，你的反應是？</label>
          <div class="options">
            <button type="button" data-score="A">A. 立刻反彈、再戰一次</button>
            <button type="button" data-score="B">B. 自我反省、思考教訓</button>
            <button type="button" data-score="C">C. 感到沮喪、有點退縮、怕再犯錯</button>
            <button type="button" data-score="D">D. 尋求或提供人際支持、共同面對</button>
          </div>
        </div>

        <div class="q" data-index="4">
          <label>5. 如果要選擇你最看重的特質，是哪一項？</label>
          <div class="options">
            <button type="button" data-score="A">A. 冒險精神 / 行動力（馬型）</button>
            <button type="button" data-score="B">B. 思考深度 / 內在探索（狐狸型）</button>
            <button type="button" data-score="C">C. 謹慎 / 安全感（男孩型）</button>
            <button type="button" data-score="D">D. 溫暖 / 支持他人（鼴鼠型）</button>
          </div>
        </div>

        <div class="btn-row">
          <button class="primary" id="submit" type="button">提交並查看結果</button>
          <button class="ghost" id="reset" type="button">重設答案</button>
        </div>
      </form>

      <div id="chartArea" style="margin-top:20px;display:none" class="card">
        <div id="resultText" style="white-space:pre-line"></div>
      </div>

      <footer>本測驗會依你的 A-D 選項統計最高分並給出四種類型分析：男孩型、鼴鼠型、狐狸型、馬型。</footer>
    </div>
  </div>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // State
    const answers = Array(5).fill(null);
    const typeMap = { A: "馬型", B: "狐狸型", C: "男孩型", D: "鼴鼠型" };

    const resultTextMap = {
      "男孩型": `關於自己，你還在學著怎麼相信。
你有很強的感受力，對世界與自己充滿好奇。你常懷疑自己夠不夠好，這份敏感讓你看見他人的情緒，也容易忽略自己的需要。
提醒：你不需要完美才值得被愛。給自己多一點溫柔。`,

      "鼴鼠型": `你的溫柔，是世界很需要的溫柔。
你重視舒服感與陪伴，懂得照顧他人心情。你的存在讓沈重變得不那麼可怕。
提醒：在照顧別人前，也問問自己：「那我呢？」你值得同樣的溫柔。`,

      "狐狸型": `你看得很清楚，只是習慣把心收好。
你敏銳、細心，不會輕易把自己交出去。你忠誠且重感情，一旦承諾就會做到。
提醒：保持界線是好事，但別把自己關太緊。給世界一點機會，也給自己機會。`,

      "馬型": `你習慣當那個「載大家走過去」的人。
你願意撐住場面、扛起責任，給人安全感。很多人依賴你，因為你看起來總是知道怎麼做。
提醒：你不必永遠那麼堅強。你也可以被照顧。`
    };

    // UI wiring
    document.querySelectorAll('.q').forEach((q,i)=>{
      q.querySelectorAll('button').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          q.querySelectorAll('button').forEach(b=>b.classList.remove('selected'));
          btn.classList.add('selected');
          answers[i] = btn.dataset.score;
        })
      })
    });

    document.getElementById('submit')).addEventListener('click', ()=>{
      // validate
      if(answers.some(a=>a===null)){
        alert('請完成所有題目');
        return;
      }
      // scoring: note emotional stability is reverse-coded (higher response -> lower stability)
      const raw = answers.slice();
      const scores = raw.map((v, idx)=>{
        if(idx===2){ // 情緒穩定性 reverse
          return 6 - v; // 1->5, 5->1
        }
        return v;
      });
      // convert 1-5 to 0-100 percent for radar visualization
      const percent = scores.map(v => Math.round((v-1)/4*100));

      // new submit handler continues here without radar chart
    document.getElementById('submit').addEventListener('click', ()=>{
      if(answers.some(a=>a===null)){
        alert('請完成所有題目');
        return;
      }

      const count = {A:0, B:0, C:0, D:0};
      answers.forEach(v=> count[v]++);
      const top = Object.keys(count).reduce((a,b)=> count[a] >= count[b] ? a : b);

      const type = typeMap[top];
      const text = `你的類型：${type}

${resultTextMap[type]}`;

      document.getElementById('chartArea').style.display='block';
      document.getElementById('resultText').textContent = text;
    });(percent);

      const meta = document.getElementById('meta');
      meta.innerHTML = `原始分數：${raw.join(', ')}；轉換後（0-100%）：${percent.join('%, ')}%`;

      // save last result for download/copy
      window._lastResult = {raw, scores, percent, traits: traitNames};
    });

    function showChart(values){
      document.getElementById('chartArea').style.display = 'block';
      const ctx = document.getElementById('radarChart').getContext('2d');
      if(radarChart) radarChart.destroy();
      radarChart = new Chart(ctx, {
        type: 'radar',
        data: {
          labels: traitNames,
          datasets: [{
            label: '你的特質分佈',
            data: values,
            fill: true,
            tension: 0.2,
            borderWidth: 2
          }]
        },
        options: {
          scales: {
            r: {
              angleLines: {display:true},
              suggestedMin: 0,
              suggestedMax: 100,
              ticks: {stepSize:20, callback: v => v + '%'}
            }
          },
          plugins: {legend:{display:false}}
        }
      });
    }

    document.getElementById('download').addEventListener('click', ()=>{
      if(!window._lastResult){ alert('尚無結果可下載'); return; }
      const link = document.createElement('a');
      link.href = document.getElementById('radarChart').toDataURL('image/png');
      link.download = 'psych-quiz-radar.png';
      link.click();
    });

    document.getElementById('copyJson').addEventListener('click', ()=>{
      if(!window._lastResult){ alert('尚無結果可複製'); return; }
      const txt = JSON.stringify(window._lastResult, null, 2);
      navigator.clipboard.writeText(txt).then(()=>alert('結果已複製到剪貼簿'))
        .catch(()=>alert('無法存取剪貼簿'));
    });
  </script>
</body>
</html>
